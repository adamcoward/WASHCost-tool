.boxed_container
  .boxed_content.page_content

    .dashboard

      .dashboard--profile
        .dashboard--profile--user
          = image_tag "http://www.gravatar.com/avatar/#{Digest::MD5.hexdigest(current_user.email.downcase.gsub(/\s/,''))}?s=200&d=#{u(localised_root_url+'/..'+image_path('image-user_placeholder.jpg'))}", :class => 'dashboard--profile--user--image'

        .dashboard--profile--details
          .dashboard--profile--details--title= current_user.name
          .dashboard--profile--details--field
            = "#{t( 'dashboard.company' )}:"
            = current_user.company.present? ? current_user.company : 'Not specified'
          .dashboard--profile--details--field
            = "#{t( 'dashboard.country' )}:"
            = Country.new(current_user.country).data.present? ? Country.new(current_user.country).name.capitalize : 'Not specified'
          .dashboard--profile--details--field
            = "#{t( 'dashboard.preferred_language' )}:"
            = current_user.prefered_language
          .dashboard--profile--details--field
            = "#{t( 'dashboard.current_mail' )}:"
            = current_user.email

          = link_to t( 'edit' ), edit_user_registration_path, :class => 'button dashboard--profile--user--button'

      %table.dashboard--report_table
        %thead
          %tr
            %th.dashboard--report_table--heading= t( 'dashboard.name' )
            %td.dashboard--report_table--heading{ :width => 20 }
            %th.dashboard--report_table--heading{ :width => 180 }= t( 'dashboard.location' )
            %th.dashboard--report_table--heading{ :width => 80 }= t( 'dashboard.date' )
            %th.dashboard--report_table--heading{ :width => 180 }= t( 'dashboard.calculator_type' )
            %th.dashboard--report_table--heading{ :width => 100 }= t( 'dashboard.service' )
            %th.dashboard--report_table--heading{ :width => 0 }

        %tbody
          - current_user.basic_questionnaires.each do |basic_questionnaire|
            %tr.dashboard--report_table--row
              %td.dashboard--report_table--cell= basic_questionnaire.title.upcase
              %td.dashboard--report_table--cell
                - if basic_questionnaire.form["country"].present?
                  %div{ :class => "flag flag-#{basic_questionnaire.form['country'].downcase}" }
              %td.dashboard--report_table--cell= Country.new(basic_questionnaire.form["country"]).name.truncate(13)
              %td.dashboard--report_table--cell= basic_questionnaire.created_at.strftime( '%d.%m.%Y' )
              %td.dashboard--report_table--cell= "Basic #{basic_questionnaire.tool_name.capitalize} (#{basic_questionnaire.percent_completed}%)"
              %td.dashboard--report_table--cell INSTALLED
              %td.dashboard--report_table--cell
                = link_to t( 'view_report' ), basic_report_load_path(id_questionnaire: basic_questionnaire.id), "data-method" => "post", :class => 'button button-small'

          - @reports.each do |report|
            %tr.dashboard--report_table--row
              %td.dashboard--report_table--cell= report.title
              %td.dashboard--report_table--cell
                - if report.questionnaire["country"].present?
                  %div{ :class => "flag flag-#{report.questionnaire['country'].downcase}" }
              %td.dashboard--report_table--cell= Country.new(report.questionnaire["country"]).name.truncate(13)
              %td.dashboard--report_table--cell= report.created_at.strftime( '%d.%m.%Y' )
              %td.dashboard--report_table--cell= "#{report.level.capitalize} #{report.type.capitalize}"
              %td.dashboard--report_table--cell INSTALLED
              %td.dashboard--report_table--cell
                = link_to t( 'view_report' ), reports_load_path( report.id ), "data-method" => "post", :class => 'button button-small'
